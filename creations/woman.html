<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>woman</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
    font-family: monospace;
  }
  canvas {
    display: block;
  }
</style>
    <link rel="stylesheet" href="../styles/counter.css">
</head>
<body>
<canvas id="asciiCanvas"></canvas>
<script>
const canvas = document.getElementById('asciiCanvas');
const ctx = canvas.getContext('2d');
let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;
const fontSize = 8;
ctx.font = fontSize + "px monospace";

const cols = Math.floor(width / fontSize);
const rows = Math.floor(height / fontSize);

const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%&*";

let matrix = [];
let colorMatrix = [];

let faceData = [];
let facePixels = [];

const img = new Image();
img.src = './resources/image01.jpg';
img.crossOrigin = "anonymous";

img.onload = function() {
    const hiddenCanvas = document.createElement('canvas');
hiddenCanvas.width = cols;
hiddenCanvas.height = rows;
const hiddenCtx = hiddenCanvas.getContext('2d');

const imgRatio = img.width / img.height;
let targetWidth = cols;
let targetHeight = Math.floor(targetWidth / imgRatio);

if (targetHeight > rows) {
    targetHeight = rows;
    targetWidth = Math.floor(targetHeight * imgRatio);
}

const offsetX = Math.floor((cols - targetWidth) / 2);
const offsetY = Math.floor((rows - targetHeight) / 2);

hiddenCtx.drawImage(img, offsetX, offsetY, targetWidth, targetHeight);

    const pixels = hiddenCtx.getImageData(0,0,cols,rows).data;

    for (let y = 0; y < rows; y++) {
        matrix[y] = [];
        colorMatrix[y] = [];
        faceData[y] = [];
        for (let x = 0; x < cols; x++) {
            const i = (y * cols + x) * 4;
            const brightness = pixels[i];
            faceData[y][x] = brightness < 128;
            matrix[y][x] = chars[Math.floor(Math.random() * chars.length)];
            colorMatrix[y][x] = 0;
            if (faceData[y][x]) facePixels.push({x, y});
        }
    }

    animate();
};

function animate() {
    ctx.fillStyle = 'rgba(0,0,0,0.05)';
    ctx.fillRect(0, 0, width, height);

    const lightenPerFrame = 30;
    for (let i = 0; i < lightenPerFrame && facePixels.length > 0; i++) {
        const index = Math.floor(Math.random() * facePixels.length);
        const {x, y} = facePixels[index];
        colorMatrix[y][x] = 1;
        facePixels.splice(index, 1);
    }

    for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
            if (Math.random() > 0.97) {
                matrix[y][x] = chars[Math.floor(Math.random() * chars.length)];
            }
            ctx.fillStyle = colorMatrix[y][x] ? '#707070' : '#444';
            ctx.fillText(matrix[y][x], x * fontSize, y * fontSize);
        }
    }

    requestAnimationFrame(animate);
}

window.addEventListener('resize', () => {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
});
</script>

<div class="page-counter">13/13</div>
<div class="page-buttons">
    <button onclick="location.href='./'">Home</button>
    <button onclick="location.href='inventory.html'">Inventory</button>
</div>

</body>
</html>


