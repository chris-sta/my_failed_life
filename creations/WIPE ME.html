<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WIPE ME</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  height: 100%;
}
#percentage {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 24px;
  font-weight: bold;
  color: #000;
  z-index: 10;
}
canvas {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
}
</style>
    <link rel="stylesheet" href="../styles/counter.css">
</head>
<body>
<div id="percentage">0%</div>

<canvas id="canvasBg"></canvas>
<canvas id="canvasOverlay"></canvas>
<canvas id="canvasCursor"></canvas>

<script>
const canvasBg = document.getElementById('canvasBg');
const ctxBg = canvasBg.getContext('2d');

const canvasOverlay = document.getElementById('canvasOverlay');
const ctxOverlay = canvasOverlay.getContext('2d');

const canvasCursor = document.getElementById('canvasCursor');
const ctxCursor = canvasCursor.getContext('2d');

let width = canvasBg.width = canvasOverlay.width = canvasCursor.width = window.innerWidth;
let height = canvasBg.height = canvasOverlay.height = canvasCursor.height = window.innerHeight;

const bg = new Image();
bg.src = './resources/image02.jpg';
let bgLoaded = false;
bg.onload = () => {
  bgLoaded = true;
  drawBackground();
  drawOverlay();
};

function drawBackground() {
  ctxBg.clearRect(0, 0, width, height);
  ctxBg.drawImage(bg, 0, 0, width, height);
}

function drawOverlay() {
  ctxOverlay.fillStyle = '#333333';
  ctxOverlay.fillRect(0, 0, width, height);
}

const rag = new Image();
rag.src = './resources/rag.png';
const ragSize = 280;

let mouse = {x: width/2, y: height/2, prevX: width/2, prevY: height/2};

function wipeBlue() {
  ctxOverlay.globalCompositeOperation = 'destination-out';
  ctxOverlay.beginPath();
  ctxOverlay.arc(mouse.x, mouse.y, 80, 0, Math.PI*2);
  ctxOverlay.fill();
  ctxOverlay.globalCompositeOperation = 'source-over';
}

function drawRagCursor() {
  ctxCursor.clearRect(0, 0, width, height);
  const dx = mouse.x - mouse.prevX || 0;
  const dy = mouse.y - mouse.prevY || 0;
  const angle = Math.sin(Date.now()/100 + Math.hypot(dx, dy)/20) * 0.5;

  ctxCursor.save();
  ctxCursor.translate(mouse.x, mouse.y);
  ctxCursor.rotate(angle);
  ctxCursor.drawImage(rag, -ragSize/2, -ragSize/2, ragSize, ragSize);
  ctxCursor.restore();
}

function calculatePercentage() {
  const data = ctxOverlay.getImageData(0, 0, width, height).data;
  let clearedPixels = 0;
  for (let i = 3; i < data.length; i += 4) {
    if (data[i] === 0) clearedPixels++;
  }
  const percent = Math.round((clearedPixels / (width*height)) * 100);
  document.getElementById('percentage').innerText = percent + '%';
}

function animate() {
  if(!bgLoaded) return requestAnimationFrame(animate);
  wipeBlue();
  drawRagCursor();
  calculatePercentage();
  mouse.prevX = mouse.x;
  mouse.prevY = mouse.y;
  requestAnimationFrame(animate);
}

canvasCursor.addEventListener('mousemove', e => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});

window.addEventListener('resize', () => {
  width = canvasBg.width = canvasOverlay.width = canvasCursor.width = window.innerWidth;
  height = canvasBg.height = canvasOverlay.height = canvasCursor.height = window.innerHeight;
  if(bgLoaded) {
    drawBackground();
    drawOverlay();
  }
});

animate();
</script>

<div class="page-counter">12/13</div>
<div class="page-buttons">
    <button onclick="location.href='./'">Home</button>
    <button onclick="location.href='inventory.html'">Inventory</button>
</div>

</body>
</html>
