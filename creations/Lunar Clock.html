<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lunar Clock</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
    margin:0; padding:0;
    background:#fdfdf9;
    overflow:hidden;
    font-family:"Courier New", monospace;
    height:100%;
}
canvas {
    display:block;
}
</style>
    <link rel="stylesheet" href="../styles/counter.css">
</head>
<body>
<canvas id="clock"></canvas>
<script>
const canvas = document.getElementById("clock");
const ctx = canvas.getContext("2d");

let w, h;
function resize() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

class Gear {
    constructor(x,y,r,teeth,speed) {
        this.x=x; this.y=y; this.r=r;
        this.teeth=teeth; this.angle=0;
        this.speed=speed;
    }
    update() {
        this.angle += this.speed;
    }
    draw(ctx) {
        ctx.save();
        ctx.translate(this.x,this.y);
        ctx.rotate(this.angle);
        ctx.beginPath();
        for(let i=0;i<this.teeth;i++){
            let a = (i/this.teeth)*2*Math.PI;
            let x = Math.cos(a)*this.r;
            let y = Math.sin(a)*this.r;
            ctx.lineTo(x*1.1, y*1.1);
        }
        ctx.closePath();
        ctx.strokeStyle="#222";
        ctx.lineWidth=2;
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(0,0,this.r*0.6,0,Math.PI*2);
        ctx.stroke();
        ctx.restore();
    }
}

const gears = [
    new Gear(w*0.5,h*0.5,80,24,0.005),
    new Gear(w*0.7,h*0.5,50,16,-0.008),
    new Gear(w*0.35,h*0.55,40,12,0.01),
    new Gear(w*0.6,h*0.7,30,10,-0.012)
];

function drawWires(ctx){
    ctx.strokeStyle="#555";
    ctx.lineWidth=1;
    for(let i=0;i<15;i++){
        ctx.beginPath();
        ctx.moveTo(Math.random()*w, Math.random()*h);
        ctx.lineTo(Math.random()*w, Math.random()*h);
        ctx.stroke();
    }
}

function getMoonPhase() {
    let now = new Date();
    let year = now.getFullYear();
    let month = now.getMonth()+1;
    let day = now.getDate();

    let c = 0;
    let e = 0;
    let jd = 0;
    let b = 0;
    if (month < 3) { year--; month +=12; }
    ++month;
    c = 365.25 * year;
    e = 30.6 * month;
    jd = c + e + day - 694039.09; 
    jd /= 29.5305882;              
    b = jd - Math.floor(jd);       
    return b; 
}

function drawMoon(ctx,x,y,r){
    let phase = getMoonPhase();
    ctx.save();
    ctx.translate(x,y);
    ctx.beginPath();
    ctx.arc(0,0,r,0,Math.PI*2);
    ctx.strokeStyle="#222";
    ctx.lineWidth=2;
    ctx.stroke();

    ctx.beginPath();
    ctx.fillStyle="#222";
    if(phase<0.5){
        ctx.arc(r*(0.5-phase*2),0,r,Math.PI*0.5,-Math.PI*0.5,true);
    } else {
        ctx.arc(-r*(phase*2-1),0,r,Math.PI*0.5,-Math.PI*0.5,false);
    }
    ctx.fill();
    ctx.restore();
}

function drawCranny(ctx){
    ctx.strokeStyle="#333";
    ctx.lineWidth=1;
    for(let i=0;i<10;i++){
        ctx.beginPath();
        let x=w*0.3 + Math.random()*w*0.4;
        let y=h*0.3 + Math.random()*h*0.4;
        ctx.moveTo(x,y);
        ctx.lineTo(x+Math.random()*20-10, y+Math.random()*20-10);
        ctx.stroke();
    }
}

function draw(){
    ctx.clearRect(0,0,w,h);

    ctx.strokeStyle="#222";
    ctx.lineWidth=4;
    ctx.strokeRect(w*0.1,h*0.1,w*0.8,h*0.8);

    drawWires(ctx);
    drawCranny(ctx);

    for(let g of gears){
        g.update();
        g.draw(ctx);
    }

    drawMoon(ctx, w*0.5, h*0.5, 40);

    requestAnimationFrame(draw);
}

draw();
</script>

<div class="page-counter">6/13</div>
<div class="page-buttons">
    <button onclick="location.href='./'">Home</button>
    <button onclick="location.href='inventory.html'">Inventory</button>
</div>

</body>
</html>
